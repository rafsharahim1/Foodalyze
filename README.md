# Foodalyze 
A YOLOv8-powered API for detecting Indian food dishes and estimating their calories.

---

## üèõÔ∏è Architecture
This diagram shows the complete MLOps workflow, from model training to a monitored API endpoint.

```mermaid
graph TD
    subgraph "MLOps & Monitoring (D5)"
        D[best.pt Model] -- registers --> M(MLflow Model Registry);
        E(FastAPI App) -- scrapes --> P(Prometheus);
        P -- datasource --> G(Grafana Dashboard);
        T(Training Data) --> EV(Evidently Report);
        V(Validation Data) --> EV;
    end

    subgraph "CI/CD Pipeline (D4)"
        A[Git Push/PR] --> B(GitHub Actions);
        B -- runs --> L(Lint);
        B -- runs --> TST(Test);
        TST -- on pass --> BLD(Build Docker Image);
        BLD -- push --> R(GHCR Registry);
        R --> DPL(Canary Deploy);
        DPL --> AT(Acceptance Tests);
    end

    subgraph "Inference API (D3, D7)"
        U[User Upload] --> E;
        E -- loads model from --> D;
        E --> J(JSON Response);
    end

## Quick Start

Get the API running on your local machine in **two simple steps**:

### 1. Clone the Repository
```bash
git clone https://github.com/alina1114/Foodalyze.git
cd Foodalyze


###  Build and Run the App

This command installs dependencies, formats code, and starts the development server.

```bash
make dev
```

After running this, the API will be available at:
[http://localhost:8000/docs](http://localhost:8000/docs)

---

## ‚öôÔ∏èMakefile Commands

Common commands are managed via the **Makefile** for consistency and ease of use.

| Command             | Description                                                                               |
| ------------------- | ----------------------------------------------------------------------------------------- |
| `make install`      | Creates a Python virtual environment and installs dependencies from `requirements.txt`.   |
| `make dev`          | Runs the FastAPI server in development mode with live-reloading.                          |
| `make lint`         | Checks the code for linting errors using `ruff` and `black`.                              |
| `make format`       | Automatically fixes any formatting or linting errors.                                     |
| `make test`         | Runs the `pytest` test suite with coverage reporting.                                     |
| `make docker`       | Builds the production-ready Docker image.                                                 |
| `make run`          | Runs the built Docker image locally on `http://localhost:8000`.                           |
| `make monitor-up`   | Starts the full monitoring stack (App, MLflow, Prometheus, Grafana) via `docker-compose`. |
| `make monitor-down` | Stops and removes all monitoring containers.                                              |

---

## üìñ API Documentation (D7)

The API documentation is automatically generated by FastAPI and is available at:

* **Swagger UI (Interactive):** [http://localhost:8000/docs](http://localhost:8000/docs)
* **ReDoc (Static):** [http://localhost:8000/redoc](http://localhost:8000/redoc)

---

###  Health Check

**Endpoint:** `GET /health`
Verifies that the API is running and that the model is successfully loaded.

---

###  Predict Endpoint

Upload an image to get **food detections**, **bounding boxes**, and **calorie estimates**.

**Endpoint:** `POST /predict`
**Query Parameter:** `conf=0.5` (optional, sets the confidence threshold)
**Body:** `image` (the image file as `multipart/form-data`)

#### Example cURL Request

```bash
curl -X 'POST' \
  'http://localhost:8000/predict?conf=0.4' \
  -H 'accept: application/json' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@/path/to/your/image.jpg'
```

#### Example JSON Response

```json
{
  "image": "your_image.jpg",
  "num_detections": 1,
  "detections": [
    {
      "class_id": 12,
      "class_name": "chana_masala",
      "confidence": 0.9234,
      "bbox": {
        "x1": 150,
        "y1": 210,
        "x2": 450,
        "y2": 500
      },
      "portion_desc": "1 bowl",
      "portion_g": 240,
      "calories_estimate": 348
    }
  ],
  "timestamp": "2025-10-28T13:00:00.000000"
}
```

---

## üìä ML Workflow Monitoring (D5)

The project includes a **complete monitoring stack** for model lifecycle and performance, managed via `docker-compose up`.

### 1Ô∏è‚É£ MLflow (Model Registry)

All trained models are versioned and registered in MLflow.

* **URL:** [http://localhost:5000](http://localhost:5000)
* **Registered Model:** [MEMBER 3: PASTE MLFLOW MODEL URL HERE]

---

### 2Ô∏è‚É£ Evidently (Data Drift)

Monitors for **data drift** between the training and test datasets.

* **Dashboard:** [http://localhost:7000](http://localhost:7000)


---

### 3Ô∏è‚É£ Prometheus & Grafana (API Metrics)

* **Prometheus** scrapes live API metrics (requests, latency, errors).

* **Grafana** visualizes these metrics in real time.

* **Grafana URL:** [http://localhost:3000](http://localhost:3000)

* **Login:** `admin / admin`

 

---

## ‚òÅÔ∏è Cloud Deployment (Bonus D9)

The application is deployed on **AWS** using two main services.

### ü™£ Service 1: AWS S3 (Model Storage)

**Why:**
S3 provides durable, scalable, and cost-effective object storage.
We use it to host the `best.pt` model file, decoupling large model assets from the Docker container.
This keeps our image small and allows model updates without rebuilding the container.

**Reproduction Steps:**

1. Create an S3 bucket.
2. Upload `best.pt`.
3. Ensure your EC2 instance has an **IAM role** with S3 read access.

---

### Service 2: AWS EC2 (Application Hosting)

**Why:**
EC2 provides a reliable virtual machine to host the Dockerized FastAPI application.

**Reproduction Steps:**

1. Launch a **t2.micro** EC2 instance with **Amazon Linux 2**.
2. Install Docker:

   ```bash
   sudo yum update -y
   sudo amazon-linux-extras install docker -y
   sudo service docker start
   sudo usermod -a -G docker ec2-user
   ```
3. Pull and run the container:

   ```bash
   docker run -d -p 80:8000 ghcr.io/alina1114/foodalyze:latest
   ```

Your API will now be available at:
üëâ `http://<your-ec2-public-ip>/docs`

---

## üß© Tech Stack

* **Backend:** FastAPI
* **ML Framework:** PyTorch + YOLOv8
* **Monitoring:** MLflow, Evidently, Prometheus, Grafana
* **Containerization:** Docker & Docker Compose
* **Cloud:** AWS EC2 + S3

---



---

## üèÅ License

This project is licensed under the **MIT License**.
See the [LICENSE](LICENSE) file for more details.

```

